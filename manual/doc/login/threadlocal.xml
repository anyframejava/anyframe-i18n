<chapter id="login_login_threadlocal">
	<title>Biz. Service에서 사용자 정보 이용</title>

	<section id="login_login_getthreadlocal">
       	<title>ThreadLocalUtil</title>
          	<para>
       			ThreadLocalUtil은 ThreadLocal을 보다 쉽게 사용할 수 있도록 제공되는 클래스이다.
       			Interceptor에서 Session에 저장된 사용자 정보를 ThreadLocalUtil의 add메소드를 이용해
       			ThreadLocal에 저장했다면 Biz. Service에서 언제든지 필요한 정보를 얻을 수 있다.
			</para>
			<para>
				예를들어 각 Service Method에 AOP를 이용해 해당 메소드를 어떤 사용자가 호출했는지
				로깅을 남길 수도 있다. 아래는 LoggingUserInfoAspect의 소스코드이다.
			</para>
			<programlisting language="java"><![CDATA[@Aspect
@Service
public class LoggingUserInfoAspect {
    
    @Before("execution(* org.anyframe.plugin.login..*Impl.*(..))")
    public void beforeLogging(JoinPoint thisJoinPoint) {
        Class<? extends Object> clazz = thisJoinPoint.getTarget().getClass();

        StringBuilder messageBuf = new StringBuilder();
		
        if( ThreadLocalUtil.isExist("userInfo")){
            UserInfo userInfo = (UserInfo)ThreadLocalUtil.get("userInfo");
			
            messageBuf
                    .append("\n-------------------------------------------------------------------------------\n");
            messageBuf.append("  This method called by " + userInfo.getUserName() +"\n");
            messageBuf
                    .append("-------------------------------------------------------------------------------");
        }

        Logger logger = LoggerFactory.getLogger(clazz);
        logger.info(messageBuf.toString());
    }
}]]></programlisting>
		<para>Biz. Service의 메소드가 호출되면 어떤 User가 메소드를 실행 했는지 로그를 남긴다.</para>
	</section>
</chapter>
